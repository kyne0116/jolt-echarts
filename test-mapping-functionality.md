# 映射功能验证测试指南

## 测试环境准备

### 1. 启动后端服务
```bash
cd jolt-echarts
mvn spring-boot:run
```

### 2. 启动前端服务
```bash
cd frontend
npm run dev
```

## API端点验证

### 1. 测试可用字段API
```bash
curl -X GET "http://localhost:8080/api/chart/placeholder-mapping/available-fields" \
  -H "Content-Type: application/json"
```

**期望结果**: 返回12个核心字段的信息

### 2. 测试占位符提取API
```bash
curl -X GET "http://localhost:8080/api/chart/placeholder-mapping/basic_line_chart/placeholders" \
  -H "Content-Type: application/json"
```

**期望结果**: 返回基础折线图的占位符列表

### 3. 测试映射配置API
```bash
curl -X GET "http://localhost:8080/api/chart/placeholder-mapping/basic_line_chart/mappings" \
  -H "Content-Type: application/json"
```

**期望结果**: 返回预置的映射配置

### 4. 测试动态映射模板API
```bash
curl -X GET "http://localhost:8080/api/chart/dynamic-mapping/templates" \
  -H "Content-Type: application/json"
```

**期望结果**: 返回3个预定义模板

## 前端功能验证

### 1. 访问映射管理页面
- URL: `http://localhost:3000/mapping`
- 检查页面是否正常加载
- 验证三个页签是否都能正常显示

### 2. 统一映射管理器测试
- 选择"统一映射管理器"页签
- 选择图表类型（如：基础折线图）
- 验证占位符列表是否正确加载
- 测试基础映射和高级配置模式切换

### 3. 高级映射管理器测试
- 选择"高级映射管理器"页签
- 选择图表类型
- 验证可用字段是否正确加载（不应出现"加载可用字段失败"错误）
- 测试占位符映射配置功能

### 4. 动态映射配置测试
- 选择"动态映射配置"页签
- 验证映射模板是否正确加载（不应出现"加载映射模板失败: undefined"错误）
- 测试模板应用功能

## 错误修复验证

### 1. API调用修复验证
- ✅ 高级映射管理器现在使用 `placeholderMappingApi` 而不是直接的 fetch 调用
- ✅ 改进了错误处理，提供更详细的错误信息
- ✅ 添加了数据格式验证

### 2. 动态映射配置修复验证
- ✅ 创建了 `DynamicMappingController` 提供缺失的API端点
- ✅ 修复了模板数据格式问题
- ✅ 改进了错误处理逻辑

### 3. 统一组件验证
- ✅ 创建了 `UnifiedMappingManager` 组件整合重复功能
- ✅ 提供了基础和高级两种配置模式
- ✅ 集成了映射状态监控和预览功能

## 功能完整性检查

### 必需功能验证清单
- [ ] 占位符提取和列表显示
- [ ] 字段映射配置
- [ ] 实时预览和测试
- [ ] 映射关系保存和加载
- [ ] 智能推荐功能
- [ ] 错误处理和用户提示

### 用户体验验证
- [ ] 页面加载速度合理
- [ ] 错误信息友好明确
- [ ] 操作流程直观
- [ ] 功能响应及时

## 性能测试

### 1. 加载性能
- 测试大量占位符的加载速度
- 验证字段列表的渲染性能

### 2. 操作响应性
- 测试映射配置的保存速度
- 验证预览功能的响应时间

## 兼容性测试

### 1. 浏览器兼容性
- Chrome (推荐)
- Firefox
- Edge
- Safari

### 2. 设备兼容性
- 桌面端 (1920x1080)
- 笔记本 (1366x768)
- 平板 (768x1024)

## 回归测试

### 1. 现有功能验证
- 确保修复没有破坏现有的转换功能
- 验证两阶段转换流程仍然正常工作
- 检查虚拟数据库集成是否正常

### 2. API兼容性
- 确保现有的API调用仍然有效
- 验证数据格式的向后兼容性

## 测试结果记录

### 成功案例
- [ ] 所有API端点正常响应
- [ ] 前端页面无错误加载
- [ ] 映射配置功能正常工作
- [ ] 预览功能正确显示结果

### 发现的问题
- [ ] 记录任何发现的新问题
- [ ] 标注问题的严重程度
- [ ] 提供问题的重现步骤

### 改进建议
- [ ] 用户体验优化建议
- [ ] 性能改进建议
- [ ] 功能增强建议

## 验证通过标准

### 基本要求
1. 所有API端点正常工作，无404或500错误
2. 前端页面正常加载，无JavaScript错误
3. 核心映射功能正常工作
4. 错误处理友好，用户体验良好

### 高级要求
1. 响应时间在可接受范围内（< 3秒）
2. 界面美观，操作直观
3. 功能完整，覆盖所有需求
4. 代码质量良好，易于维护

## 后续优化建议

### 短期优化
1. 添加更多的输入验证
2. 改进错误提示的具体性
3. 优化加载状态的显示

### 长期优化
1. 实现映射配置的版本管理
2. 添加映射配置的导入导出功能
3. 实现映射配置的批量操作
4. 添加映射配置的历史记录功能
