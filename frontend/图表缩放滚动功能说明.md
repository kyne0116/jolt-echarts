# 图表展示区缩放和滚动功能实现说明

## 功能概述

为两阶段演示应用的图表展示区添加了滚动条功能和放大镜功能，提升用户查看图表的体验。

## 新增功能

### 1. 滚动条功能
- **自动显示/隐藏**：当图表内容超出容器尺寸时，自动在图表展示区右侧和底部显示滚动条
- **样式一致性**：滚动条样式与右侧数据卡片区的JSON查看器滚动条保持完全一致
- **流畅滚动**：支持鼠标滚轮和拖拽滚动条进行内容浏览

### 2. 放大镜/缩放功能
- **鼠标滚轮缩放**：在图表区域使用鼠标滚轮进行放大/缩小操作
- **缩放按钮控制**：右上角提供 +/- 按钮进行精确缩放控制
- **缩放范围**：支持 50% 到 300% 的缩放范围
- **缩放步长**：每次缩放步长为 20%，确保平滑的缩放体验

### 3. 图表平移功能
- **拖拽平移**：当图表被放大后，支持鼠标拖拽查看图表的不同区域
- **智能光标**：根据缩放状态自动切换光标样式（grab/grabbing/move）
- **平滑移动**：拖拽操作具有平滑的视觉反馈

### 4. 重置功能
- **一键重置**：提供重置按钮，一键恢复到原始大小和位置
- **状态指示**：在图表标题区域显示当前缩放比例
- **智能禁用**：当处于默认状态时，重置按钮自动禁用

## 技术实现

### HTML结构修改

```vue
<div class="chart-wrapper">
  <!-- 缩放控制按钮 -->
  <div class="chart-zoom-controls" v-if="chartInstance">
    <a-button-group size="small">
      <a-button @click="zoomIn" :disabled="chartZoom >= 3">+</a-button>
      <a-button @click="zoomOut" :disabled="chartZoom <= 0.5">-</a-button>
      <a-button @click="resetChartZoom" :disabled="chartZoom === 1">重置</a-button>
    </a-button-group>
  </div>

  <!-- 可滚动的图表容器 -->
  <div class="chart-scroll-container">
    <div
      ref="chartContainer"
      class="chart-container"
      :style="{
        transform: `scale(${chartZoom})`,
        transformOrigin: 'top left',
        width: `${100 / chartZoom}%`,
        height: `${100 / chartZoom}%`
      }"
      @wheel="handleChartWheel"
      @mousedown="handleChartMouseDown"
      @mousemove="handleChartMouseMove"
      @mouseup="handleChartMouseUp"
    ></div>
  </div>
</div>
```

### 响应式状态管理

```typescript
// 图表缩放和拖拽状态
const chartZoom = ref(1)
const isDragging = ref(false)
const dragStart = ref({ x: 0, y: 0 })
const chartOffset = ref({ x: 0, y: 0 })
```

### 核心方法实现

#### 缩放控制
```typescript
const zoomIn = () => {
  if (chartZoom.value < 3) {
    chartZoom.value = Math.min(3, chartZoom.value + 0.2)
    updateChartSize()
  }
}

const zoomOut = () => {
  if (chartZoom.value > 0.5) {
    chartZoom.value = Math.max(0.5, chartZoom.value - 0.2)
    updateChartSize()
  }
}

const resetChartZoom = () => {
  chartZoom.value = 1
  chartOffset.value = { x: 0, y: 0 }
  updateChartSize()
}
```

#### 鼠标滚轮缩放
```typescript
const handleChartWheel = (event: WheelEvent) => {
  event.preventDefault()
  const delta = event.deltaY > 0 ? -0.1 : 0.1
  const newZoom = Math.max(0.5, Math.min(3, chartZoom.value + delta))
  
  if (newZoom !== chartZoom.value) {
    chartZoom.value = newZoom
    updateChartSize()
  }
}
```

#### 拖拽平移
```typescript
const handleChartMouseDown = (event: MouseEvent) => {
  if (chartZoom.value <= 1) return // 只有放大时才允许拖拽
  
  isDragging.value = true
  dragStart.value = { x: event.clientX, y: event.clientY }
  event.preventDefault()
}

const handleChartMouseMove = (event: MouseEvent) => {
  if (!isDragging.value || chartZoom.value <= 1) return
  
  const deltaX = event.clientX - dragStart.value.x
  const deltaY = event.clientY - dragStart.value.y
  
  chartOffset.value = {
    x: chartOffset.value.x + deltaX,
    y: chartOffset.value.y + deltaY
  }
  
  dragStart.value = { x: event.clientX, y: event.clientY }
  updateChartTransform()
}
```

### CSS样式实现

#### 滚动容器样式
```css
.chart-scroll-container {
  flex: 1;
  overflow: auto;
  position: relative;
  background: #ffffff;
  border: 1px solid #e8e8e8;
  border-radius: 6px;
}

/* 滚动条样式 - 与JSON查看器保持一致 */
.chart-scroll-container::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

.chart-scroll-container::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.chart-scroll-container::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 3px;
}

.chart-scroll-container::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}
```

#### 缩放控制按钮样式
```css
.chart-zoom-controls {
  position: absolute;
  top: 8px;
  right: 8px;
  z-index: 10;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 4px;
  padding: 4px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}
```

#### 图表容器样式
```css
.chart-preview-card .chart-container {
  min-width: 100%;
  min-height: 100%;
  background: #ffffff;
  position: relative;
  display: block;
  cursor: grab;
  transition: transform 0.1s ease-out;
}

.chart-preview-card .chart-container:active {
  cursor: grabbing;
}

.chart-preview-card .chart-container.zoomed {
  cursor: move;
}
```

## 响应式设计

### 移动端适配
- 缩放控制按钮在移动端自动调整大小和位置
- 触摸设备支持双指缩放（通过浏览器原生支持）
- 滚动条在移动端自动隐藏，使用原生滚动行为

### 不同屏幕尺寸适配
- 大屏幕（≥1200px）：完整功能，最佳体验
- 中等屏幕（768px-1199px）：保持所有功能，调整按钮大小
- 小屏幕（≤768px）：简化控制界面，保持核心功能

## 兼容性说明

### 浏览器支持
- Chrome 60+：完整支持所有功能
- Firefox 60+：完整支持所有功能
- Safari 12+：完整支持所有功能
- Edge 79+：完整支持所有功能

### 与现有功能的兼容性
- ✅ 保持与现有布局的完全兼容
- ✅ 不影响其他区域的显示和功能
- ✅ 与ECharts图表库完美集成
- ✅ 支持所有图表类型（折线图、柱状图、饼图、雷达图等）

## 测试验证

### 测试文件
- `frontend/chart-zoom-test.html` - 独立功能测试页面
- 使用雷达图作为测试用例，验证所有功能

### 测试场景
1. **基础缩放测试**：验证放大/缩小功能
2. **滚轮缩放测试**：验证鼠标滚轮缩放
3. **拖拽平移测试**：验证图表拖拽功能
4. **滚动条测试**：验证滚动条显示和功能
5. **重置功能测试**：验证一键重置功能
6. **响应式测试**：验证不同屏幕尺寸下的表现

## 使用说明

### 用户操作指南
1. **放大图表**：使用鼠标滚轮向上滚动，或点击右上角的 "+" 按钮
2. **缩小图表**：使用鼠标滚轮向下滚动，或点击右上角的 "-" 按钮
3. **平移图表**：当图表放大后，按住鼠标左键拖拽图表查看不同区域
4. **重置视图**：点击右上角的重置按钮，或在卡片标题区域点击重置按钮
5. **滚动查看**：当图表内容超出容器时，使用滚动条或鼠标滚轮浏览

### 状态指示
- 卡片标题区域显示当前缩放比例
- 图表初始化状态显示
- 数据就绪状态显示
- 按钮状态根据当前缩放级别自动启用/禁用

## 性能优化

### 渲染优化
- 使用CSS transform进行缩放，避免重新渲染图表
- 拖拽操作使用requestAnimationFrame优化
- 滚动事件使用防抖处理

### 内存管理
- 图表实例正确销毁和重建
- 事件监听器及时清理
- 避免内存泄漏

这些功能的实现大大提升了用户查看和分析图表的体验，特别是对于复杂图表或需要查看细节的场景。
