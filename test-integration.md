# 占位符映射管理系统集成测试指南

## 🎯 测试目标

验证重构后的占位符映射管理系统和两阶段转换功能的完整性和正确性。

## 📋 测试环境准备

### 1. 启动后端服务
```bash
cd jolt-echarts
mvn spring-boot:run
```

### 2. 启动前端服务
```bash
cd frontend
npm run dev
```

### 3. 验证服务状态
- 后端：http://localhost:8080
- 前端：http://localhost:3000

## 🧪 功能测试清单

### 任务一：占位符映射管理页面测试

#### 1.1 页面基础功能
- [ ] 访问 http://localhost:3000/mapping
- [ ] 验证页面正常加载，无JavaScript错误
- [ ] 检查左右分栏布局是否正确显示

#### 1.2 图表选择功能
- [ ] 图表分类下拉框正常工作
- [ ] 具体图表下拉框根据分类动态更新
- [ ] 图表信息卡片正确显示选择的图表详情

#### 1.3 映射配置功能
- [ ] 选择图表后自动加载占位符列表
- [ ] 可用字段按组正确分类显示
- [ ] 占位符映射配置表单正常工作
- [ ] 映射进度条正确显示完成度

#### 1.4 CRUD操作测试
- [ ] 保存映射配置功能正常
- [ ] 智能推荐功能生成合理的映射建议
- [ ] 预览功能显示转换结果
- [ ] 映射配置列表正确显示已保存的配置

#### 1.5 列表管理功能
- [ ] 查看映射详情模态框正常显示
- [ ] 编辑功能正确加载现有配置
- [ ] 删除功能正常工作
- [ ] 批量删除功能正常工作

### 任务二：两阶段转换功能测试

#### 2.1 基础转换流程
- [ ] 访问 http://localhost:3000/transformation
- [ ] 选择图表类型和具体图表
- [ ] 执行完整转换流程
- [ ] 验证四个数据流卡片都有内容

#### 2.2 数据来源验证
- [ ] 检查第二阶段输出是否显示数据来源标识
- [ ] 验证"虚拟数据库"标签出现（绿色）
- [ ] 检查映射覆盖率标签显示
- [ ] 确认显示的是真实数据而非模拟数据

#### 2.3 映射依赖提示
- [ ] 当映射覆盖率<100%时，显示"配置映射"按钮
- [ ] 点击"配置映射"按钮正确跳转到映射管理页面
- [ ] 配置完映射后，转换结果应显示更高的覆盖率

#### 2.4 预览功能增强
- [ ] 数据预览显示来自虚拟数据库的真实数据
- [ ] 图表渲染使用真实数据而非默认值
- [ ] 错误处理友好，提供清晰的错误信息

## 🔍 API端点验证

### 占位符映射管理API
```bash
# 获取所有映射配置
curl -X GET "http://localhost:8080/api/chart/placeholder-mapping/list"

# 获取可用字段
curl -X GET "http://localhost:8080/api/chart/placeholder-mapping/available-fields"

# 获取占位符
curl -X GET "http://localhost:8080/api/chart/placeholder-mapping/basic_line_chart/placeholders"

# 智能推荐
curl -X POST "http://localhost:8080/api/chart/placeholder-mapping/basic_line_chart/generate-defaults" \
  -H "Content-Type: application/json" \
  -d '{"placeholders": ["${chart_title}", "${categories}", "${series_1_data}"]}'
```

### 两阶段转换API
```bash
# 完整转换流程
curl -X POST "http://localhost:8080/api/chart/two-stage/basic_line_chart/full-transform" \
  -H "Content-Type: application/json" \
  -d '{}'
```

## 📊 数据验证标准

### 1. 数据来源验证
- **虚拟数据库数据特征**：
  - 包含真实的月份数据（1月-12月）
  - 包含真实的渠道数据（Email, Social Media, Direct）
  - 包含真实的产品数据（产品A, 产品B, 产品C）
  - 数值范围合理（金额100-300，数量10-60）

- **默认值数据特征**：
  - 包含占位符文本或null值
  - 数据结构简单，缺乏真实性
  - 数值为固定值或模拟值

### 2. 映射覆盖率验证
- **100%覆盖率**：所有占位符都有对应的映射配置
- **部分覆盖率**：部分占位符使用默认值
- **0%覆盖率**：完全使用默认值或模拟数据

## 🎯 验收标准

### 功能完整性（必须100%通过）
- [ ] 占位符映射管理页面所有功能正常
- [ ] 两阶段转换使用真实映射关系
- [ ] 预览结果显示来自虚拟数据库的数据
- [ ] 所有图表类型都支持映射配置

### 用户体验（必须90%以上满意）
- [ ] 操作流程直观，用户容易理解
- [ ] 错误提示友好，帮助用户解决问题
- [ ] 页面响应速度快（<3秒）
- [ ] 界面美观，符合设计规范

### 技术质量（必须95%以上通过）
- [ ] 代码结构清晰，遵循项目规范
- [ ] API接口设计合理，支持前端需求
- [ ] 数据一致性保障，映射修改正确反映
- [ ] 错误处理完善，系统稳定性好

## 🐛 常见问题排查

### 1. 映射配置不生效
- 检查后端PlaceholderMappingManager是否正确初始化
- 验证API调用是否成功
- 确认前端状态管理是否正确更新

### 2. 数据来源显示错误
- 检查TwoStageTransformationService的数据验证逻辑
- 验证虚拟数据库是否有足够的测试数据
- 确认映射关系是否正确配置

### 3. 页面加载错误
- 检查前端路由配置
- 验证组件导入是否正确
- 确认API端点是否可访问

### 4. 图表渲染问题
- 检查ECharts配置是否正确
- 验证数据格式是否符合ECharts要求
- 确认图表容器是否正确初始化

## 📈 性能测试

### 1. 加载性能
- 页面首次加载时间 < 2秒
- 图表选择响应时间 < 1秒
- 映射配置保存时间 < 3秒

### 2. 数据处理性能
- 占位符提取时间 < 500ms
- 映射执行时间 < 1秒
- 预览生成时间 < 2秒

### 3. 内存使用
- 页面内存占用 < 100MB
- 无明显内存泄漏
- 长时间使用稳定

## 🎉 测试完成标准

当以下条件全部满足时，认为集成测试通过：

1. **功能测试**：所有测试项目100%通过
2. **API测试**：所有端点正常响应
3. **数据验证**：确认使用真实数据
4. **用户体验**：操作流程顺畅
5. **性能指标**：满足性能要求
6. **错误处理**：异常情况处理得当

## 📝 测试报告模板

```markdown
# 占位符映射管理系统测试报告

## 测试概要
- 测试时间：[日期]
- 测试环境：[环境信息]
- 测试人员：[姓名]

## 测试结果
- 功能测试通过率：[百分比]
- 性能测试结果：[详情]
- 发现问题数量：[数量]

## 问题列表
1. [问题描述] - [严重程度] - [状态]

## 改进建议
1. [建议内容]

## 结论
[通过/不通过] - [原因说明]
```
